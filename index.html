<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Revenue List</title>
    <style>
        body { font-family: sans-serif; }
        #controls { margin-bottom: 10px; }
        #storeList { border-collapse: collapse; width: 80%; margin: auto; }
        #storeList th, #storeList td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #storeList th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Store Revenues (100 Stores)</h1>

    <div id="controls">
        <label for="searchInput">Search Store:</label>
        <input type="text" id="searchInput" onkeyup="updateData()">

        <label for="minRevenue">Min Revenue:</label>
        <input type="number" id="minRevenue" onkeyup="updateData()">

        <label for="maxRevenue">Max Revenue:</label>
        <input type="number" id="maxRevenue" onkeyup="updateData()">

        <label for="sortBy">Sort By:</label>
        <select id="sortBy" onchange="updateData()">
            <option value="name">Name</option>
            <option value="revenue">Revenue</option>
        </select>

        <label for="sortOrder">Order:</label>
        <select id="sortOrder" onchange="updateData()">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
        </select>
    </div>

    <div id="dataDisplay">
        </div>

    <script>
        const dataDisplay = document.getElementById('dataDisplay');
        const searchInput = document.getElementById('searchInput');
        const minRevenueInput = document.getElementById('minRevenue');
        const maxRevenueInput = document.getElementById('maxRevenue');
        const sortBySelect = document.getElementById('sortBy');
        const sortOrderSelect = document.getElementById('sortOrder');

        async function fetchAndDisplayData() {
            const searchTerm = searchInput.value.toLowerCase();
            const sortBy = sortBySelect.value;
            const sortOrder = sortOrderSelect.value;
            const minRevenue = minRevenueInput.value;
            const maxRevenue = maxRevenueInput.value;

            let url = `https://andonoff.pythonanywhere.com/api/revenue?search=${searchTerm}&sort_by=${sortBy}&sort_order=${sortOrder}`;
            
            if (minRevenue !== '') {
                url += `&min_revenue=${minRevenue}`;
            }
            if (maxRevenue !== '') {
                url += `&max_revenue=${maxRevenue}`;
            }

            try {
                const response = await fetch(url);
                const data = await response.json();
                displayData(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                dataDisplay.innerHTML = '<p>Error loading data.</p>';
            }
        }

        function displayData(stores) {
            // Sort the stores array based on the selected criteria
            const sortBy = document.getElementById('sortBy').value;
            const sortOrder = document.getElementById('sortOrder').value;

            stores.sort((a, b) => {
                let comparison = 0;
                if (sortBy === 'name') {
                    const nameA = parseInt(a.name.substring(6)); // Extract the number
                    const nameB = parseInt(b.name.substring(6));
                    comparison = nameA - nameB;
                } else if (sortBy === 'revenue') {
                    comparison = a.revenue - b.revenue;
                }

                return sortOrder === 'desc' ? comparison * -1 : comparison;
            });

            let html = '<table id="storeList"><thead><tr><th>Name</th><th>Revenue</th></tr></thead><tbody>';
            stores.forEach(store => {
                html += `<tr><td>${store.name}</td><td>$${store.revenue.toLocaleString()}</td></tr>`;
            });
            html += '</tbody></table>';
            dataDisplay.innerHTML = html;
        }

        function updateData() {
            fetchAndDisplayData();
        }

        // Initial data load
        fetchAndDisplayData();
    </script>
</body>
</html>